<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Render Tree — render_tree • rayshader</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Render Tree — render_tree"><meta property="og:description" content="Adds a 3D representation of trees to an existing 3D scene generated with rayshader.
Users can specify the trees' geographical positions using latitude and longitude or the same coordinate reference system as `extent`.
Different types of tree models can be used, including a basic and a cone-shaped tree. Users can also use their own custom tree model in
OBJ format. The function allows customization of various aspects of the tree, including the color of the crown and the trunk,
the size of the crown (the leafy part of the tree) and the trunk, the overall scale of the tree, and the rotation angle around the x, y, and z axes.
Users can also specify the minimum and maximum height of the trees to be rendered."><meta property="og:image" content="https://www.rayshader.com/reference/figures/website.jpg"><meta property="og:image:alt" content="Picture of a 3D map made with rayshader"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@tylermorganwall"><meta name="twitter:site" content="@tylermorganwall"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rayshader</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.38.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home"></span>

  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials/Blog Posts

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="https://www.tylermw.com/adding-open-street-map-data-to-rayshader-maps-in-r/" class="external-link">Tutorial: Adding Open Street Map Data to Rayshader Maps in R</a>
    </li>
    <li>
      <a href="https://www.tylermw.com/a-step-by-step-guide-to-making-3d-maps-with-satellite-imagery-in-r/" class="external-link">A Step-by-Step Guide to Making 3D Maps with Satellite Imagery in R</a>
    </li>
    <li>
      <a href="https://www.tylermw.com/3d-ggplots-with-rayshader/" class="external-link">Introducing 3D ggplots with rayshader</a>
    </li>
    <li>
      <a href="https://www.tylermw.com/portrait-mode-data/" class="external-link">Portrait Mode for Data: Rayshader + Rayfocus</a>
    </li>
    <li>
      <a href="https://www.tylermw.com/3d-printing-rayshader/" class="external-link">From R to Reality: 3D Printing Maps with Rayshader</a>
    </li>
    <li>
      <a href="https://www.tylermw.com/3d-maps-with-rayshader/" class="external-link">Slicing Through Monterey Bay: Creating 3D Maps with Rayshader</a>
    </li>
    <li>
      <a href="https://www.tylermw.com/making-beautiful-maps/" class="external-link">Draining Lake Mead: Making Beautiful Maps with Rayshader</a>
    </li>
    <li>
      <a href="https://www.tylermw.com/throwing-shade/" class="external-link">Throwing Shade at the Cartographer Illuminati: Raytracing the Washington Monument in R</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>

    Changelog
  </a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>

    functions
  </a>
</li>
<li>
  <a href="https://github.com/tylermorganwall/rayshader" class="external-link">
    <span class="fa fa-github fa-lg"></span>

    GitHub
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Render Tree</h1>
    <small class="dont-index">Source: <a href="https://github.com/tylermorganwall/rayshader/blob/master/R/render_tree.R" class="external-link"><code>R/render_tree.R</code></a></small>
    <div class="hidden name"><code>render_tree.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Adds a 3D representation of trees to an existing 3D scene generated with rayshader.
Users can specify the trees' geographical positions using latitude and longitude or the same coordinate reference system as `extent`.
Different types of tree models can be used, including a basic and a cone-shaped tree. Users can also use their own custom tree model in
OBJ format. The function allows customization of various aspects of the tree, including the color of the crown and the trunk,
the size of the crown (the leafy part of the tree) and the trunk, the overall scale of the tree, and the rotation angle around the x, y, and z axes.
Users can also specify the minimum and maximum height of the trees to be rendered.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">render_tree</span><span class="op">(</span></span>
<span>  lat <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  long <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  extent <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"basic"</span>,</span>
<span>  custom_obj_tree <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  custom_obj_crown <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  custom_obj_trunk <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  crown_color <span class="op">=</span> <span class="st">"#22aa22"</span>,</span>
<span>  trunk_color <span class="op">=</span> <span class="st">"#964B00"</span>,</span>
<span>  absolute_height <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  tree_height <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  trunk_height_ratio <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  crown_width_ratio <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  crown_width <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  trunk_radius <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tree_zscale <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  min_height <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  max_height <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  zscale <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  lit <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  heightmap <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  baseshape <span class="op">=</span> <span class="st">"rectangle"</span>,</span>
<span>  angle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  clear_previous <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-lat">lat<a class="anchor" aria-label="anchor" href="#arg-lat"></a></dt>
<dd><p>Vector of latitudes (or other coordinate in the same coordinate reference system as extent).</p></dd>


<dt id="arg-long">long<a class="anchor" aria-label="anchor" href="#arg-long"></a></dt>
<dd><p>Vector of longitudes (or other coordinate in the same coordinate reference system as extent).</p></dd>


<dt id="arg-extent">extent<a class="anchor" aria-label="anchor" href="#arg-extent"></a></dt>
<dd><p>Either an object representing the spatial extent of the 3D scene
(either from the `raster`, `terra`, `sf`, or `sp` packages),
a length-4 numeric vector specifying `c("xmin", "xmax", "ymin", "ymax")`, or the spatial object (from
the previously aforementioned packages) which will be automatically converted to an extent object.</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>Default `"basic"`. Type of tree. Other built-in option: `"cone"`.</p></dd>


<dt id="arg-custom-obj-tree">custom_obj_tree<a class="anchor" aria-label="anchor" href="#arg-custom-obj-tree"></a></dt>
<dd><p>Default `NULL`. Instead of using the built-in types, users can also load a custom tree
model in OBJ format. This function loads and manipulates the model, assuming the tree model's trunk begins
at the origin. Color and specific trunk/crown proportions will be fixed to the model specified, although the overall
scale can be changed per-tree via `crown_height`.</p></dd>


<dt id="arg-custom-obj-crown">custom_obj_crown<a class="anchor" aria-label="anchor" href="#arg-custom-obj-crown"></a></dt>
<dd><p>Default `NULL`. Instead of using the built-in types, users can also load a custom crown
model in OBJ format. This function loads a crown model and allows you to control the crown and trunk proportions separately.</p></dd>


<dt id="arg-custom-obj-trunk">custom_obj_trunk<a class="anchor" aria-label="anchor" href="#arg-custom-obj-trunk"></a></dt>
<dd><p>Default `NULL`.  Instead of using the built-in types, users can also load a custom trunk
model in OBJ format. This function loads a trunk model and allows you to control the crown and trunk proportions separately.</p></dd>


<dt id="arg-crown-color">crown_color<a class="anchor" aria-label="anchor" href="#arg-crown-color"></a></dt>
<dd><p>Default `"darkgreen"`. Color(s) of the crown.</p></dd>


<dt id="arg-trunk-color">trunk_color<a class="anchor" aria-label="anchor" href="#arg-trunk-color"></a></dt>
<dd><p>Default `"#964B00"` (brown). Color(s) of the trunk,</p></dd>


<dt id="arg-absolute-height">absolute_height<a class="anchor" aria-label="anchor" href="#arg-absolute-height"></a></dt>
<dd><p>Default `FALSE`. Default is specifying the tree height directly, relative to the
underlying height map. If `TRUE`, `crown_height` will specified by the actual altitude of the top of the tree.
Total tree height will be `crown_height + trunk_height`.</p></dd>


<dt id="arg-tree-height">tree_height<a class="anchor" aria-label="anchor" href="#arg-tree-height"></a></dt>
<dd><p>Default `NULL`. Height of the tree, automatically set to `10` if not specified. If `absolute_height = TRUE`, then this is interpreted as
the altitude of the top of the tree in the coordinate reference system used. If `absolute_height = FALSE`, then
this is interpreted as the height of the tree relative to the underlying heightmap.</p></dd>


<dt id="arg-trunk-height-ratio">trunk_height_ratio<a class="anchor" aria-label="anchor" href="#arg-trunk-height-ratio"></a></dt>
<dd><p>Default `NULL`. The ratio of the height of the trunk to the total height of the tree.
Default is 1/3rd the crown height if `type = "basic"`, and 1/6th the crown height if `type = "cone"`.</p></dd>


<dt id="arg-crown-width-ratio">crown_width_ratio<a class="anchor" aria-label="anchor" href="#arg-crown-width-ratio"></a></dt>
<dd><p>Default `NULL`. Ratio of the crown width to the crown height. A value of `1` is spherical.</p></dd>


<dt id="arg-crown-width">crown_width<a class="anchor" aria-label="anchor" href="#arg-crown-width"></a></dt>
<dd><p>Default `NULL`. As an alternative to specifying the ratio, you can use this argument to
specify the crown width directly.</p></dd>


<dt id="arg-trunk-radius">trunk_radius<a class="anchor" aria-label="anchor" href="#arg-trunk-radius"></a></dt>
<dd><p>Default `NULL`, automatically computed.
Default is 1/5rd the trunk height if `type = "basic"`, and 1/10th the trunk height if `type = "cone"`.</p></dd>


<dt id="arg-tree-zscale">tree_zscale<a class="anchor" aria-label="anchor" href="#arg-tree-zscale"></a></dt>
<dd><p>Default `TRUE`. Whether to scale the size of the tree by zscale to have it match
the size of the map. If zscale is very big, this will make the trees very small.</p></dd>


<dt id="arg-min-height">min_height<a class="anchor" aria-label="anchor" href="#arg-min-height"></a></dt>
<dd><p>Default `NULL`. Minimum height of a tree. Set to a positive number to filter out trees
below that height.</p></dd>


<dt id="arg-max-height">max_height<a class="anchor" aria-label="anchor" href="#arg-max-height"></a></dt>
<dd><p>Default `NA`. Maximum height of a tree. Set to a positive number to filter out trees
above that height.</p></dd>


<dt id="arg-zscale">zscale<a class="anchor" aria-label="anchor" href="#arg-zscale"></a></dt>
<dd><p>Default `1`. The ratio between the x and y spacing (which are assumed to be equal) and the z axis in the original heightmap.</p></dd>


<dt id="arg-lit">lit<a class="anchor" aria-label="anchor" href="#arg-lit"></a></dt>
<dd><p>Default `TRUE`. Whether to apply lighting to the tree.</p></dd>


<dt id="arg-heightmap">heightmap<a class="anchor" aria-label="anchor" href="#arg-heightmap"></a></dt>
<dd><p>Default `NULL`. Automatically extracted from the rgl window–only use if auto-extraction
of matrix extent isn't working. A two-dimensional matrix, where each entry in the matrix is the elevation at that point.
All points are assumed to be evenly spaced.</p></dd>


<dt id="arg-baseshape">baseshape<a class="anchor" aria-label="anchor" href="#arg-baseshape"></a></dt>
<dd><p>Default `rectangle`. Shape of the base. Options are `c("rectangle","circle","hex")`.</p></dd>


<dt id="arg-angle">angle<a class="anchor" aria-label="anchor" href="#arg-angle"></a></dt>
<dd><p>Default `c(0,0,0)`. Angle of rotation around the x, y, and z axes. If this is a matrix or list,
each row (or list entry) specifies the rotation of the nth tree specified (number of rows/length of list must
equal the length of `lat`/`long`).</p></dd>


<dt id="arg-clear-previous">clear_previous<a class="anchor" aria-label="anchor" href="#arg-clear-previous"></a></dt>
<dd><p>Default `FALSE`. If `TRUE`, it will clear all existing trees.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments to pass to `rgl::triangles3d()`.</p></dd>

</dl></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="run_documentation.html">run_documentation</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">#Let's first start by drawing some trees in a circle around Monterey Bay</span></span></span>
<span class="r-in"><span><span class="co">#We won't scale these to a realistic size (yet)</span></span></span>
<span class="r-in"><span><span class="va">moss_landing_coord</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">36.806807</span>, <span class="op">-</span><span class="fl">121.793332</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">montereybay</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span> <span class="fu"><a href="sphere_shade.html">sphere_shade</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span> <span class="fu"><a href="plot_3d.html">plot_3d</a></span><span class="op">(</span><span class="va">montereybay</span>,zscale<span class="op">=</span><span class="fl">50</span>,water<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>         shadowcolor<span class="op">=</span><span class="st">"#40310a"</span>, background <span class="op">=</span> <span class="st">"tan"</span>,</span></span>
<span class="r-in"><span>         theta<span class="op">=</span><span class="fl">210</span>,  phi<span class="op">=</span><span class="fl">22</span>, zoom<span class="op">=</span><span class="fl">0.20</span>, fov<span class="op">=</span><span class="fl">55</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">t</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span><span class="op">*</span><span class="va">pi</span>,length.out<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">circle_coords_lat</span> <span class="op">=</span> <span class="va">moss_landing_coord</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">circle_coords_long</span> <span class="op">=</span> <span class="va">moss_landing_coord</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">render_tree</span><span class="op">(</span>extent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">montereybay</span>,<span class="st">"extent"</span><span class="op">)</span>, heightmap <span class="op">=</span> <span class="va">montereybay</span>,</span></span>
<span class="r-in"><span>           tree_zscale <span class="op">=</span> <span class="cn">FALSE</span>, tree_height <span class="op">=</span> <span class="fl">30</span>,  lit <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>           lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">circle_coords_lat</span><span class="op">)</span>, long <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">circle_coords_long</span><span class="op">)</span>, zscale<span class="op">=</span><span class="fl">50</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="render_snapshot.html">render_snapshot</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="render_tree-1.png" alt="" width="768" height="768"></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="run_documentation.html">run_documentation</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">#Change the crown width ratio (compared to the height)</span></span></span>
<span class="r-in"><span><span class="fu">render_tree</span><span class="op">(</span>extent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">montereybay</span>,<span class="st">"extent"</span><span class="op">)</span>, heightmap <span class="op">=</span> <span class="va">montereybay</span>,</span></span>
<span class="r-in"><span>           tree_zscale <span class="op">=</span> <span class="cn">FALSE</span>, tree_height <span class="op">=</span> <span class="fl">60</span>, crown_width_ratio <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>           clear_previous <span class="op">=</span> <span class="cn">TRUE</span>, </span></span>
<span class="r-in"><span>           lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">circle_coords_lat</span><span class="op">)</span>, long <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">circle_coords_long</span><span class="op">)</span>, zscale<span class="op">=</span><span class="fl">50</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="render_snapshot.html">render_snapshot</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="render_tree-2.png" alt="" width="768" height="768"></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="run_documentation.html">run_documentation</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">#Change the trunk height and width</span></span></span>
<span class="r-in"><span><span class="fu">render_tree</span><span class="op">(</span>extent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">montereybay</span>,<span class="st">"extent"</span><span class="op">)</span>, heightmap <span class="op">=</span> <span class="va">montereybay</span>,</span></span>
<span class="r-in"><span>           tree_zscale <span class="op">=</span> <span class="cn">FALSE</span>, tree_height <span class="op">=</span> <span class="fl">40</span>, crown_width_ratio <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>           clear_previous <span class="op">=</span> <span class="cn">TRUE</span>, trunk_height_ratio<span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, trunk_radius <span class="op">=</span> <span class="fl">1.5</span>,</span></span>
<span class="r-in"><span>           lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">circle_coords_lat</span><span class="op">)</span>, long <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">circle_coords_long</span><span class="op">)</span>, zscale<span class="op">=</span><span class="fl">50</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="render_snapshot.html">render_snapshot</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="render_tree-3.png" alt="" width="768" height="768"></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="run_documentation.html">run_documentation</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">#Change the tree type</span></span></span>
<span class="r-in"><span><span class="fu">render_tree</span><span class="op">(</span>extent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">montereybay</span>,<span class="st">"extent"</span><span class="op">)</span>, heightmap <span class="op">=</span> <span class="va">montereybay</span>,</span></span>
<span class="r-in"><span>           tree_zscale <span class="op">=</span> <span class="cn">FALSE</span>, tree_height <span class="op">=</span> <span class="fl">30</span>, </span></span>
<span class="r-in"><span>           clear_previous <span class="op">=</span> <span class="cn">TRUE</span>, type <span class="op">=</span> <span class="st">"cone"</span>,trunk_height_ratio <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">6</span>,</span></span>
<span class="r-in"><span>           lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">circle_coords_lat</span><span class="op">)</span>, long <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">circle_coords_long</span><span class="op">)</span>, zscale<span class="op">=</span><span class="fl">50</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="render_snapshot.html">render_snapshot</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="render_tree-4.png" alt="" width="768" height="768"></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="run_documentation.html">run_documentation</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">#Change the crown color:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="render_camera.html">render_camera</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="fl">150</span>,  phi <span class="op">=</span> <span class="fl">38</span>, zoom <span class="op">=</span> <span class="fl">0.4</span>, fov <span class="op">=</span> <span class="fl">55</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">render_tree</span><span class="op">(</span>extent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">montereybay</span>,<span class="st">"extent"</span><span class="op">)</span>, heightmap <span class="op">=</span> <span class="va">montereybay</span>,</span></span>
<span class="r-in"><span>           tree_zscale <span class="op">=</span> <span class="cn">FALSE</span>, tree_height <span class="op">=</span> <span class="fl">30</span>, crown_width_ratio <span class="op">=</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           crown_color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span>,  clear_previous <span class="op">=</span> <span class="cn">TRUE</span>, </span></span>
<span class="r-in"><span>           lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">circle_coords_lat</span><span class="op">)</span>, long <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">circle_coords_long</span><span class="op">)</span>, zscale<span class="op">=</span><span class="fl">50</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="render_snapshot.html">render_snapshot</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="render_tree-5.png" alt="" width="768" height="768"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#We will use the lidR package to generate a DEM and detect the crown tops of trees, and</span></span></span>
<span class="r-in"><span><span class="co">#then use rayshader to render 3D tree models scaled to those heights on the map.</span></span></span>
<span class="r-in"><span><span class="va">run_example</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">find.package</a></span><span class="op">(</span><span class="st">"lidR"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;&amp;</span> </span></span>
<span class="r-in"><span>             <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">find.package</a></span><span class="op">(</span><span class="st">"sf"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;&amp;</span> </span></span>
<span class="r-in"><span>             <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">find.package</a></span><span class="op">(</span><span class="st">"terra"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;&amp;</span></span></span>
<span class="r-in"><span>             <span class="fu"><a href="run_documentation.html">run_documentation</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run_example</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">#Load the example data from the lidR package</span></span></span>
<span class="r-in"><span><span class="va">LASfile</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Topography.laz"</span>, package<span class="op">=</span><span class="st">"lidR"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">las</span> <span class="op">=</span> <span class="fu">lidR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lidR/man/readLAS.html" class="external-link">readLAS</a></span><span class="op">(</span><span class="va">LASfile</span>, filter <span class="op">=</span> <span class="st">"-inside 273450 5274350 273550 5274450"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Convert the lidar point data to a DEM and detect the location of trees from the same data</span></span></span>
<span class="r-in"><span><span class="va">dem</span> <span class="op">=</span> <span class="fu">lidR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lidR/man/rasterize.html" class="external-link">rasterize_terrain</a></span><span class="op">(</span><span class="va">las</span>, algorithm <span class="op">=</span> <span class="fu">lidR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lidR/man/dtm_tin.html" class="external-link">tin</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tree_top_data</span> <span class="op">=</span> <span class="fu">lidR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lidR/man/locate_trees.html" class="external-link">locate_trees</a></span><span class="op">(</span><span class="va">las</span>, <span class="fu">lidR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lidR/man/itd_lmf.html" class="external-link">lmf</a></span><span class="op">(</span>ws <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tree_locations</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">tree_top_data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Convert DEM to a matrix and extract the extent of the scene</span></span></span>
<span class="r-in"><span><span class="va">dem_matrix</span> <span class="op">=</span> <span class="fu"><a href="raster_to_matrix.html">raster_to_matrix</a></span><span class="op">(</span><span class="va">dem</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dem_extent</span> <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">dem</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">extent_values</span> <span class="op">=</span> <span class="va">dem_extent</span><span class="op">@</span><span class="va">ptr</span><span class="op">$</span><span class="va">vector</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Plot the ground</span></span></span>
<span class="r-in"><span><span class="va">dem_matrix</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="height_shade.html">height_shade</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="add_shadow.html">add_shadow</a></span><span class="op">(</span><span class="fu"><a href="texture_shade.html">texture_shade</a></span><span class="op">(</span><span class="va">dem_matrix</span><span class="op">)</span>,<span class="fl">0.2</span><span class="op">)</span> <span class="op">|&gt;</span> </span></span>
<span class="r-in"><span> <span class="fu"><a href="add_shadow.html">add_shadow</a></span><span class="op">(</span><span class="fu"><a href="lamb_shade.html">lamb_shade</a></span><span class="op">(</span><span class="va">dem_matrix</span><span class="op">)</span>,<span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span> </span></span>
<span class="r-in"><span> <span class="fu"><a href="plot_3d.html">plot_3d</a></span><span class="op">(</span><span class="va">dem_matrix</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="render_snapshot.html">render_snapshot</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="render_tree-6.png" alt="" width="768" height="768"></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run_example</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">#The tree locations are given as an absolute height (as opposed to relative to the surface)</span></span></span>
<span class="r-in"><span><span class="co">#so we set `absolute_height = TRUE`.</span></span></span>
<span class="r-in"><span><span class="fu">render_tree</span><span class="op">(</span>lat <span class="op">=</span> <span class="va">tree_locations</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, </span></span>
<span class="r-in"><span>           long <span class="op">=</span> <span class="va">tree_locations</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>           crown_width_ratio <span class="op">=</span> <span class="fl">0.5</span>, </span></span>
<span class="r-in"><span>           absolute_height <span class="op">=</span> <span class="cn">TRUE</span>, </span></span>
<span class="r-in"><span>           tree_height <span class="op">=</span> <span class="va">tree_locations</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>           trunk_height_ratio <span class="op">=</span> <span class="fl">0.2</span> <span class="op">+</span> <span class="fl">0.1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">tree_locations</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           crown_color <span class="op">=</span> <span class="st">"#00aa00"</span>,</span></span>
<span class="r-in"><span>           extent <span class="op">=</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html" class="external-link">extent</a></span><span class="op">(</span><span class="va">extent_values</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>           heightmap <span class="op">=</span> <span class="va">dem_matrix</span>,</span></span>
<span class="r-in"><span>           clear_previous <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>           </span></span>
<span class="r-in"><span><span class="co">#Remove existing lights and add our own with rgl</span></span></span>
<span class="r-in"><span><span class="fu">rgl</span><span class="fu">::</span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/scene.html" class="external-link">pop3d</a></span><span class="op">(</span><span class="st">"lights"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">rgl</span><span class="fu">::</span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/light.html" class="external-link">light3d</a></span><span class="op">(</span>phi<span class="op">=</span><span class="fl">35</span>,theta<span class="op">=</span><span class="fl">90</span>, viewpoint.rel<span class="op">=</span><span class="cn">F</span>, diffuse<span class="op">=</span><span class="st">"#ffffff"</span>, specular<span class="op">=</span><span class="st">"#000000"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">rgl</span><span class="fu">::</span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/light.html" class="external-link">light3d</a></span><span class="op">(</span>phi<span class="op">=</span><span class="op">-</span><span class="fl">45</span>,theta<span class="op">=</span><span class="op">-</span><span class="fl">40</span>, viewpoint.rel<span class="op">=</span><span class="cn">F</span>, diffuse<span class="op">=</span><span class="st">"#aaaaaa"</span>, specular<span class="op">=</span><span class="st">"#000000"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="render_snapshot.html">render_snapshot</a></span><span class="op">(</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>longer object length is not a multiple of shorter object length</span>
<span class="r-plt img"><img src="render_tree-7.png" alt="" width="768" height="768"></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run_example</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">#Render tree also works with `render_highquality()`</span></span></span>
<span class="r-in"><span><span class="fu"><a href="render_highquality.html">render_highquality</a></span><span class="op">(</span>lightdirection<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">90</span>,<span class="fl">45</span><span class="op">)</span>,lightaltitude<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">90</span>,<span class="fl">45</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                  lightcolor<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dodgerblue"</span>,<span class="st">"orange"</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                  min_variance <span class="op">=</span> <span class="fl">0</span>, sample_method<span class="op">=</span><span class="st">"sobol_blue"</span>, clamp_value<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="render_tree-8.png" alt="" width="768" height="768"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://www.tylermw.com" class="external-link">Tyler Morgan-Wall</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

